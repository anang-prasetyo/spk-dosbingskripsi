import{_ as R,b as o,e as n,i as a,d as I,a as _,u as W,r as C,c as P,w as X,y as M,j as c,f as u,h as v,F as ee,A as te,g as ae,k as U,t as se,N as ie,n as m,T as B,C as le,D as oe,O as ne,m as f,v as re,x as de}from"./index.772c5328.js";import{u as ue}from"./DataService.5f1e1429.js";import E from"./MinusIcon.3aaa5cb9.js";import H from"./ArrowDownIcon.9d70420b.js";import{u as ce}from"./OtherFunctions.92fbf448.js";const ve={},ge={width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},me=a("path",{d:"M7.39999 6.32003L15.89 3.49003C19.7 2.22003 21.77 4.30003 20.51 8.11003L17.68 16.6C15.78 22.31 12.66 22.31 10.76 16.6L9.91999 14.08L7.39999 13.24C1.68999 11.34 1.68999 8.23003 7.39999 6.32003Z",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),he=a("path",{d:"M10.11 13.6501L13.69 10.0601",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round"},null,-1),pe=[me,he];function ke(e,N){return o(),n("svg",ge,pe)}const O=R(ve,[["render",ke]]);const j=e=>(re("data-v-da3b5010"),e=e(),de(),e),ye={class:"welcome-popup",style:{width:"75%"}},fe={key:1},be={key:0},xe={key:1},we={key:0},Me={key:0},De={style:{"letter-spacing":".25px"}},Ie={key:0},_e={key:1},Ce={id:"chatBoxMobile",class:"chat-mobile"},Ne={key:1,class:"chat-mobile-box-2"},Se={id:"chatBox"},Te={key:0,class:"chat-box-2"},Fe={key:1},Ve=j(()=>a("div",{class:"isi-pesan-blank"},[a("div",{class:"float-center"},[a("div",{style:{display:"flex","flex-direction":"column","align-items":"center",gap:".5rem"}},[a("div",{class:"text-125 text-semi-bold"},"Belum ada obrolan di sini."),a("div",null,"Mulai percakapan.")])])],-1)),Ue=[Ve],Ae={key:1,class:"isi-pesan m-0"},Le=j(()=>a("div",{class:"isi-pesan-blank"},[a("div",{class:"float-center"}," Pilih kontak untuk memulai percakapan ")],-1)),$e=[Le],Pe={id:"pesan-isi-bottom-fixed",class:"fixed-bottom"},Be={key:0},Ee={key:0,class:"flex"},He={key:0,class:"left"},Oe=["src","alt"],Re={key:2,class:"disable button-my",style:{padding:"0px 6px !important"}},je={key:1,class:"flex flex-skeleton"},Ye={__name:"PesanIsi2",props:{idGC:String,namaDosen:String,gender:String,dataMessages:Array,selectedUser:Object,participants:Array,diklik:Boolean,isVerify:Boolean,lightMode:Boolean},setup(e){const N=e,Y=I(()=>_(()=>import("./PesanReservasi.21ce88f8.js"),["assets/PesanReservasi.21ce88f8.js","assets/PesanReservasi.63c3f990.css","assets/index.772c5328.js","assets/index.0fa03077.css","assets/vue-spinner-tail.26a20ac7.js","assets/sweetalert.min.b2bbc6aa.js","assets/DataService.5f1e1429.js"])),G=I(()=>_(()=>import("./PesanHeader2.d5d4cfa6.js"),["assets/PesanHeader2.d5d4cfa6.js","assets/PesanHeader2.764fcf67.css","assets/index.772c5328.js","assets/index.0fa03077.css","assets/ArrowLeftIcon.6c88f09a.js","assets/ArrowLeftIcon.63607ffc.css"])),q=I(()=>_(()=>import("./PesanHeaderSkeleton.7fe91156.js"),["assets/PesanHeaderSkeleton.7fe91156.js","assets/PesanHeaderSkeleton.6f055e89.css","assets/ArrowLeftIcon.6c88f09a.js","assets/ArrowLeftIcon.63607ffc.css","assets/index.772c5328.js","assets/index.0fa03077.css"])),z=I(()=>_(()=>import("./PesanComponent.70da79c5.js"),["assets/PesanComponent.70da79c5.js","assets/PesanComponent.84ff01ec.css","assets/index.772c5328.js","assets/index.0fa03077.css"])),{thisUser:t}=W(),{updateChatting:g,getDocChatting:d,updateUsers:A}=ue(),{delay:L}=ce(),S=C(null),h=C(!0),$=async()=>{h.value=!0,await L(200).then(()=>{var r;(r=T.value)==null||r.scrollIntoView({behavior:"smooth"})})},b=C({text:""}),D=P(()=>N.dataMessages),i=P(()=>N.idGC),T=C(null);X(D,()=>{ne(()=>{var r;(r=T.value)==null||r.scrollIntoView({behavior:"smooth"})})},{deep:!0});const J=async()=>{var r=new Date().getMonth()+1+"/"+new Date().getDate()+"/"+new Date().getFullYear();console.log(r);const l=async()=>{await d(i.value).get().then(async y=>{if(y.exists){var k=y.data(),w=k.messagesLatest.date;console.log(w),w!==r?(g(i.value,{messagesToday:!0}),s.isFirstToday=!0):(g(i.value,{messagesToday:!1}),s.isFirstToday=!1)}})};var s={userId:t.value.user.userId,userName:t.value.user.userName,userNim:t.value.user.userNIM,profile:{avatar:t.value.profile.avatar,url:t.value.profile.url,background:t.value.profile.background,color:t.value.profile.color},text:b.value.text,date:new Date().getMonth()+1+"/"+new Date().getDate()+"/"+new Date().getFullYear(),time:String(new Date().getHours()).padStart(2,"0")+":"+String(new Date().getMinutes()).padStart(2,"0"),createdAt:new Date,isFirstToday:null},p={messagesLatest:{userId:t.value.user.userId,userName:t.value.user.userName,text:b.value.text,date:new Date().getMonth()+1+"/"+new Date().getDate()+"/"+new Date().getFullYear(),time:String(new Date().getHours()).padStart(2,"0")+":"+String(new Date().getMinutes()).padStart(2,"0"),createdAt:new Date}},x={userId:t.value.user.userId,userName:t.value.user.userName,messagesUnreadUser:0,isFav:!0,isNewMsg:!1};const F=async()=>{d(i.value).get().then(async y=>{y.exists&&await d(i.value).collection("participants").doc(t.value.user.userId).get().then(k=>{k.exists?(d(i.value).collection("participants").doc(t.value.user.userId).update({userName:x.userName,messagesUnreadUser:0}),t.value.user.userLevel!=="Dosen"?g(i.value,{messagesUnreadDosen:f.firestore.FieldValue.increment(1)}):g(i.value,{messagesUnreadDosen:0})):(d(i.value).collection("participants").doc(t.value.user.userId).set(x),t.value.user.userLevel==="Dosen"?(g(i.value,{participants:f.firestore.FieldValue.increment(1),messagesUnreadDosen:0}),console.log("dosen ini mah")):(g(i.value,{participants:f.firestore.FieldValue.increment(1),messagesUnreadDosen:f.firestore.FieldValue.increment(1)}),console.log("bukan dosen ini mah")))})})},V=async()=>{var y=null;g(i.value,{messagesTotal:f.firestore.FieldValue.increment(1)}),L(1e3),d(i.value).get().then(async k=>{k.exists&&(y=k.data(),await d(i.value).collection("messages").doc("docMsg1").get().then(w=>{w.exists?d(i.value).collection("messages").doc("docMsg"+y.messagesTotal).set(s):d(i.value).collection("messages").doc("docMsg1").set(s)}))}),d(i.value).collection("participants").get().then(k=>{k.forEach(w=>{w.ref.update({messagesUnreadUser:f.firestore.FieldValue.increment(1),isNewMsg:!0})})}),d(i.value).collection("participants").doc(t.value.user.userId).update({isNewMsg:!1}),b.value.text=""},Q=async()=>{A(t.value.user.userId,{isFav:f.firestore.FieldValue.arrayUnion(i.value)})};await l().then(()=>V()).then(()=>g(i.value,p)).then(()=>F()).then(()=>Q())},K=r=>{S.value=r},Z=(r,l)=>{A(t.value.user.userId,{"skripsi.judul":r,"skripsi.deskripsi":l,isSkripsi:!0}),d(i.value).get().then(async s=>{var p=s.data(),x={skripsiJudul:r,skripsiDeskripsi:l,userName:t.value.user.userName,userNIM:t.value.user.userNIM,userId:t.value.user.userId,date:new Date().getMonth()+1+"/"+new Date().getDate()+"/"+new Date().getFullYear(),time:String(new Date().getHours()).padStart(2,"0")+":"+String(new Date().getMinutes()).padStart(2,"0"),createdAt:new Date};d(i.value).collection("applications").doc(t.value.user.userId).get().then(F=>{if(F.exists)d(i.value).collection("applications").doc(t.value.user.userId).set(x),console.log("user pernah melakukan request, berhasil rewrite request");else if(p.applicationsAccept.length!==0){var V=p.applicationsAccept.includes(t.value.user.userId);V?console.log("kamu sudah diterima di bimbingan skripsi ini"):(d(i.value).collection("applications").doc(t.value.user.userId).set(x),g(i.value,{applicationsTotal:Number(p.applicationsTotal+1)}))}else d(i.value).collection("applications").doc(t.value.user.userId).set(x),g(i.value,{applicationsTotal:Number(p.applicationsTotal+1)})})})};return(r,l)=>(o(),n("div",null,[S.value?(o(),n("div",{key:0,class:"pop-up",style:M(e.lightMode?"background: rgba(219, 219, 219, 0.5);":"background: rgba(0, 0, 0, 0.5);")},[a("div",ye,[c(u(Y),{onIsCloseModal:K,onSendApplication:Z,"light-mode":e.lightMode},null,8,["light-mode"])])],4)):v("",!0),u(t)?(o(),n("div",fe,[a("div",null,[e.gender?(o(),n("div",be,[c(u(G),{namaDosen:e.namaDosen,gender:e.gender,participants:e.participants,selectedUser:e.selectedUser,isVerify:e.isVerify,"light-mode":e.lightMode,onPesanIsi:l[0]||(l[0]=s=>r.$emit("pesanIsi","close"))},null,8,["namaDosen","gender","participants","selectedUser","isVerify","light-mode"])])):(o(),n("div",xe,[c(u(q),{"light-mode":e.lightMode,onPesanIsi:l[1]||(l[1]=s=>r.$emit("pesanIsi","close"))},null,8,["light-mode"])]))]),u(D)?(o(),n("div",we,[e.diklik?(o(),n("div",{key:0,class:"isi-pesan m-0",style:M(h.value?"padding-bottom: 9rem !important":"")},[u(D).length!==0?(o(),n("div",Me,[(o(!0),n(ee,null,te(u(D),s=>{var p;return o(),ae(u(z),{key:s.id,name:s.userName,nim:s.userNim,nick:u(ie)(s.userName),profile:s.profile,sender:s.userId===((p=u(t))==null?void 0:p.user.userId),time:s.time,date:s.date,"created-at":s.createdAt.toDate(),"is-first-today":s.isFirstToday,"light-mode":e.lightMode},{default:U(()=>[a("div",De,se(s.text),1)]),_:2},1032,["name","nim","nick","profile","sender","time","date","created-at","is-first-today","light-mode"])}),128)),u(t).user.userLevel!=="Mahasiswa"&&(h.value=null)?(o(),n("div",Ie)):v("",!0),u(t).user.userLevel==="Mahasiswa"?(o(),n("div",_e,[a("div",Ce,[h.value?(o(),n("div",{key:0,class:m(["chat-mobile-box",e.lightMode?"dark-text":"white-text"]),style:M(e.lightMode?"background: rgba(244,247,248,.5);":"background: rgba(24,25,28,.5);")},[a("div",{class:"chat-mobile-box-msg",onClick:l[2]||(l[2]=s=>S.value=!0)},"Reservasi bimbingan skripsi"),a("div",{class:"mx-4 dot warning",style:{"max-width":"1rem"},"data-tooltip":"Sembunyikan","data-tooltip-location":"left",onClick:l[3]||(l[3]=s=>h.value=!1)},[c(E)])],6)):v("",!0),h.value?v("",!0):(o(),n("div",Ne,[a("div",{class:"close-mobile-2","data-tooltip":"Tampilkan",onClick:l[4]||(l[4]=s=>$())},[c(H,{style:{transform:"rotate(180deg)"}})])]))]),a("div",Se,[c(B,{name:"slide-fade-up"},{default:U(()=>[h.value?(o(),n("div",{key:0,class:m(["chat-box",e.lightMode?"dark-text":"white-text"]),style:M(e.lightMode?"background: rgba(244,247,248,.5);":"background: rgba(24,25,28,.5);")},[a("div",{class:"chat-box-msg",onClick:l[5]||(l[5]=s=>r.$emit("isOpenModal",!0))},"Reservasi bimbingan skripsi"),a("div",{class:"mx-4 dot warning",style:{"max-width":"1rem"},"data-tooltip":"Sembunyikan","data-tooltip-location":"left",onClick:l[6]||(l[6]=s=>h.value=!1)},[c(E)])],6)):v("",!0)]),_:1}),c(B,{name:"slide-fade-up"},{default:U(()=>[h.value?v("",!0):(o(),n("div",Te,[a("div",{class:"close-2","data-tooltip":"Tampilkan",onClick:l[7]||(l[7]=s=>$())},[c(H,{style:{transform:"rotate(180deg)"}})])]))]),_:1})])])):v("",!0)])):(o(),n("div",Fe,Ue))],4)):(o(),n("div",Ae,$e))])):v("",!0),a("div",{ref_key:"bottom",ref:T,class:""},[a("div",{id:"pesan-isi-bottom",class:"bottom",style:M(e.diklik&&e.lightMode?"background: rgba(244,247,248,.5);":e.diklik&&!e.lightMode?"background: rgba(24,25,28,.5);":e.lightMode?"background: var(--light-layout)":"background: var(--dark-layout)")},[a("div",Pe,[e.diklik?(o(),n("div",Be,[e.dataMessages?(o(),n("div",Ee,[u(t)?(o(),n("div",He,[a("div",{class:m(["main sm",u(t).profile.background])},[a("img",{src:u(t).profile.url,alt:u(t).profile.url},null,8,Oe)],2)])):v("",!0),a("div",{class:m(["textarea-my-nh border-bottom-primary",e.lightMode?"textarea-my-nh-light":"textarea-my-nh-dark"])},[le(a("textarea",{class:m(["textarea-my-nh--input",e.lightMode?"textarea-my-nh-light--input":"textarea-my-nh-dark--input"]),"onUpdate:modelValue":l[8]||(l[8]=s=>b.value.text=s),placeholder:"Tulis sebuah pesan ..."},null,2),[[oe,b.value.text]])],2),b.value.text!==""?(o(),n("button",{key:1,onClick:l[9]||(l[9]=s=>J()),"data-tooltip":"Kirim pesan","data-tooltip-location":"left"},[c(O,{class:m(["float dark-text",e.lightMode?"dark-text":"white-text"]),style:{cursor:"pointer"}},null,8,["class"])])):(o(),n("div",Re,[c(O,{class:m(["float dark-text",e.lightMode?"dark-text":"white-text"]),style:{cursor:"pointer"}},null,8,["class"])]))])):v("",!0)])):(o(),n("div",je,[a("div",{class:m(["skeleton-icon",e.lightMode?"light-mode-bg":"dark-mode-bg"])},null,2),a("div",{class:m(["skeleton-type",e.lightMode?"light-mode-bg":"dark-mode-bg"])},null,2),a("div",{class:m(["skeleton-icon",e.lightMode?"light-mode-bg":"dark-mode-bg"])},null,2)]))])],4)],512)])):v("",!0)]))}},Ze=R(Ye,[["__scopeId","data-v-da3b5010"]]);export{Ze as default};
