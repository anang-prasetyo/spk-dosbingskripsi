import{_ as O,u as G,d as S,a as x,r as _,c as M,w as b,o as j,b as m,e as C,f as l,g as y,h as D,i,j as r,n as p,k as h,T,l as P,R as U}from"./index.772c5328.js";import{u as z}from"./OtherFunctions.92fbf448.js";import{u as K}from"./DataService.5f1e1429.js";import{s as I}from"./sweetalert.min.b2bbc6aa.js";const W={key:0,class:"toast"},$={id:"layout",class:"columns m-0",style:{height:"100vh"}},q={id:"layout-mid",class:"column p-0 m-0",style:{"max-height":"100vh",overflow:"auto"}},J={class:"m-0 p-0"},Q={class:"side-bar px-4"},X={__name:"HomePage",setup(Y){const{delay:A}=z(),{thisUser:t}=G(),{getDocChatting:g,isNewMsg:c,thisNewMsg:s,updateUsers:B}=K(),E=S(()=>x(()=>import("./ToastPesan.7ff01dc8.js"),["assets/ToastPesan.7ff01dc8.js","assets/ToastPesan.ccfba879.css","assets/index.772c5328.js","assets/index.0fa03077.css"])),w=S(()=>x(()=>import("./MenuLeft.6bebd1c6.js"),["assets/MenuLeft.6bebd1c6.js","assets/MenuLeft.e6e139bb.css","assets/index.772c5328.js","assets/index.0fa03077.css","assets/sweetalert.min.b2bbc6aa.js"])),v=_(null),k=async e=>{await A(300),v.value=e,console.log("isMenu.value =>",v.value)},n=_(!0),N=e=>{n.value=e},f=_(null),F=M(()=>{var e=null;return t.value!==null&&t.value.user.userLevel==="Mahasiswa"&&(e=t.value.progres.isDosbing),e});b(()=>F.value===!0,e=>{console.log("newDosbing =>",e),e===!0&&I({title:"Selamat!",text:"Kamu berhasil menyelesaikan progres Mendapat Dosen Pembimbing Skripsi."})});const H=M(()=>{var e=null;return t.value!==null&&t.value.user.userLevel==="Mahasiswa"&&(e=t.value.progres.notifHitungSaw),e});b(()=>H.value===!0,e=>{console.log("newHitungSaw =>",e),e===!0&&I({title:"Selamat!",text:"Kamu berhasil menyelesaikan progres Menghitung SAW.",closeOnClickOutside:!1}).then(()=>{B(t.value.user.userId,{"progres.notifHitungSaw":!1})})});const V=async e=>{let o=e.isFav;if(s.value.idGroupChat=o,o.length!==0){for(let a=0;a<o.length;a++)g(o[a]).collection("participants").doc(t.value.user.userId).onSnapshot(d=>{let u=d.data();s.value.messagesUnreadUser[a]=u.messagesUnreadUser,c.value=u.isNewMsg,u.isNewMsg===!0&&(f.value=!0,setTimeout(()=>f.value=!1,5e3))});for(let a=0;a<o.length;a++)g(o[a]).collection("messages").orderBy("createdAt").onSnapshot(d=>{let u=[];d.forEach(R=>{u.push(R.data())}),s.value.messagesUnreadUser[a]>0&&(s.value.messages=u.slice(-1))}),g(o[a]).onSnapshot(d=>{let u=d.data();s.value.groupName=u.alternatif.namaDosen}),g(o[a]).collection("participants").doc(t.value.user.userId).update({isNewMsg:!1})}s.value.done=!0},L=M(()=>{var e=null;return t.value!==null&&t.value.isFav.length!==0&&c.value===!0&&(e=c.value),e});return b(()=>L.value,()=>{if(t.value!==null&&c.value===!0){let o=t.value.isFav;for(var e=0;e<o.length;e++)g(o[e]).collection("participants").doc(t.value.user.userId).update({isNewMsg:!1});console.log("reset")}}),j(()=>{V(t.value)}),(e,o)=>(m(),C("div",{class:p(n.value?"light-mode-bg":"dark-mode-bg")},[f.value?(m(),C("div",W,[l(s).done?(m(),y(l(E),{key:0,img:l(s).messages[l(s).messages.length-1].profile.url,bg:l(s).messages[l(s).messages.length-1].profile.background,group:"Grub "+l(s).groupName.namaDepan+" "+l(s).groupName.namaBelakang,sender:l(s).messages[l(s).messages.length-1].userName,msg:l(s).messages[l(s).messages.length-1].text,onClick:o[0]||(o[0]=a=>e.getNewMsg())},null,8,["img","bg","group","sender","msg"])):D("",!0)])):D("",!0),i("div",{id:"layout-left-mobile",class:p(v.value?"menu-left-mobile-open":"menu-left-mobile-close")},[r(l(w),{lightMode:n.value,isMenu:v.value,onMode:N,onToggleMenu:k},null,8,["lightMode","isMenu"])],2),i("div",$,[i("div",{id:"layout-left",class:p(["column menu-left p-0 pr-3",n.value?"light-mode-bg":"dark-mode-bg"])},[r(l(w),{lightMode:n.value,onMode:N},null,8,["lightMode"])],2),i("div",q,[i("div",J,[r(l(U),null,{default:h(({Component:a})=>[r(T,{name:"page-slide",mode:"out-in"},{default:h(()=>[(m(),y(P(a),{lightMode:n.value,onToggleMenu:k},null,40,["lightMode"]))]),_:2},1024)]),_:1})])]),i("div",{id:"layout-right",class:p(["column p-0",n.value?"light-mode-bg":"dark-mode-bg"]),style:{position:"sticky","z-index":"6"}},[i("div",Q,[r(l(U),{name:"rvRight"},{default:h(({Component:a})=>[r(T,{name:"page-slide",mode:"out-in"},{default:h(()=>[(m(),y(P(a),{lightMode:n.value},null,8,["lightMode"]))]),_:2},1024)]),_:1})])],2)])],2))}},le=O(X,[["__scopeId","data-v-5576366e"]]);export{le as default};
